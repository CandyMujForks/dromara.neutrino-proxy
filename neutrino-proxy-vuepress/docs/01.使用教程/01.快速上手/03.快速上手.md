---
title: 快速上手
date: 2020-05-11 13:54:40
permalink: /pages/793dcb
article: false
---

## 1. 打包
 可直接前往Gitee仓库发行版页面下载所需版本已打好的包。若需手动打包，则可参照下面的执行命令：
```text
# 服务端打包
mvn clean install -U -pl neutrino-proxy-server -am -Dmaven.test.skip=true

# 客户端打包
clean install -U -pl neutrino-proxy-client -am -Dmaven.test.skip=true

# 管理后台前端项目打包（本地环境，local改为dev则为dev环境，同时需要修改config目录下面的环境配置）
npm run build:local
```

## 2. 部署
### 2.2  服务端部署
- 使用常规的jar包部署方式即可，如：java -jar xxxx
### 2.4 管理后台部署
 - Nginx方式部署（推荐）:
```conf
server {
        listen 9527;
        server_name localhost;

 #开启gzip
 gzip  on;
 #低于1kb的资源不压缩
 gzip_min_length 1k;
 #压缩级别1-9，越大压缩率越高，同时消耗cpu资源也越多，建议设置在5左右。
 gzip_comp_level 5;
 #需要压缩哪些响应类型的资源，多个空格隔开。不建议压缩图片.
 gzip_types text/plain application/javascript application/x-javascript text/javascript text/xml text/css;
 #配置禁用gzip条件，支持正则。此处表示ie6及以下不启用gzip（因为ie低版本不支持）
 gzip_disable "MSIE [1-6]\.";
 #是否添加“Vary: Accept-Encoding”响应头
 gzip_vary on;

 location / {
            root  /work/projects/neutrino-proxy-server/neutrino-proxy-admin/dist;
            try_files $uri $uri/ /index.html;
            add_header Last-Modified $date_gmt;
 }
}
````
 - 无nginx时
   在没有Nginx时，为了快速体验代理效果，可直接使用服务端项目提供的静态资源服务。直接将neutrino-proxy-admin打包后的文件解压放在neutrino-proxy-server.jar同级别目录下即可。例如：服务端配置的web端口为8080，则访问http://服务端IP:8080, 则会直接解析渲染neutrino-proxy-server.jar同级别目录下neutrino-proxy-admin/dist/index.html。

::: warning
需要注意的是，使用服务端自带的静态资源服务时，由于框架目前未支持缓存、gzip压缩，所以访问速度没有使用nginx快，正式使用推荐用nginx。
:::

## 3.配置

### 3.1  配置端口池
端口池的作用是将代理服务需要对外暴露的端口进行集中管理，方便安全组设置时统一操作。

本项目为了简化首次配置，默认初始化数据会将9101～9120的所有端口加入端口池。可以在服务端项目sql配置(port_pool.data.sql文件)中自行修改初始化数据，也可以运行后在端口池管理页面手动维护。

首次使用如果为了快速体验，建议直接使用默认端口池，则无需任何配置。

### 3.2  配置License
License是客户端连接代理服务端时所需要的唯一合法凭证，一个License同时只能被一个客户端使用。

本项目为了简化首次配置，默认为每个用户初始化了一些license。可以在服务端项目sql配置(license.data.sql文件)中自行修改初始化数据，也可以运行后在License管理页面手动维护。

首次使用如果为了快速体验，建议直接使用默认License，则无需任何配置。

### 3.3  配置端口映射
端口映射是代理的基本单元，一个外网端口在同一时刻被唯一的映射到一个内网IP+端口。所有流出该外网端口的流量都转发自对应的内网端口，同理所有流入该外网端口的流量都会转发到对应的内网端口。

本项目为了简化首次配置，默认为每个用户初始化了一些端口映射。可以在服务端项目sql配置(port_mapping.data.sql文件)中自行修改初始化数据，也可以运行后在端口映射管理页面手动维护。

首次使用如果为了快速体验，建议直接使用默认端口映射，则无需任何配置。

### 3.4  开启代理
上述步骤完成后，就可以开始代理自己的局域网设备了。

比如现在有一个license：a123456，该license配置了一个或多个端口映射，其中包含9010到localhost:8080的映射（localhost表示代理客户端所在主机的端口，可以换成客户端所在局域网的任何IP）。此时修改客户端配置的服务端ip、license等启动客户端，就可以开启代理了，端口映射管理对应的记录在线状态为"在线"则证明代理成功建立。

该license配置也可以通过客户端启动参数、启动后引导式输入、外置配置提供，为了简化首次体验门槛，这里直接提供一个外置配置模版：
```json
{
 "jksPath":"classpath:/test.jks",
 "licenseKey":"b0a907332b474b25897c4dcb31fc7eb6",
 "serverIp":"localhost",
 "serverPort":9002,
 "sslEnable":true
}
```
修改上述json中的licenseKey，serverIp、serverPort、sslEnabled后，保存文件命名为<font color="#9b6e23">.neutrino-proxy-client.json</font>,放在客户端当前目录下（jar包启动时，放在jar包同级别目录下。idea启动时，放在项目根目录下），然后直接启动客户端。

此时通过访问外网ip+端口，可以成功访问内网服务。通过此方式，可以代理任何基于TCP之上的协议，如：socket、websocket、http、ftp、ssh等。

## 4.开发&调试
篇幅所限，此处不便赘述管理后台相关的开发，有vue基础的童鞋基本都可以自行开发。服务端的初始化数据足够调试工作，开发过程无需单独在管理页面操作。

与SpringBoot项目类似，客户端、服务端项目均由一个入口类完成整个项目的启动，分别为ProxyClient、ProxyServer。

内置配置采用yml风格，主要涉及Http端口、静态资源路径、协议参数、代理服务端端口、jks证书、数据源、license等。整个项目基于neutrino-core，风格类似于SpringBoot。笔者不喜欢因过分炫技而引入过多花式操作，因为项目的定位是个人开发者，且满足使用的同时兼顾学习其原理的需求。基本使用方式与SpringBoot类似，尽可能降低首次学习成本。

neutrino-core项目test目录下包含众多核心封装的测试代码，通过调试这些代码，能尽可能减少大家学习的障碍。


## 5.运行截图
### 用户管理
<img :src="$withBase('/img/run-example/user-manager1.png')"></img>
### 端口池管理
<img :src="$withBase('/img/run-example/port-pool1.png')"></img>
### License管理
<img :src="$withBase('/img/run-example/license1.png')"></img>
### 端口映射管理
<img :src="$withBase('/img/run-example/port-mapping1.png')"></img>
### 客户端启动示例
<img :src="$withBase('/img/run-example/client-run1.png')"></img>

<!--
## 4.开发&调试

::: tip
  1. 不建议在原默认vuepress项目上单独安装使用本主题包，而是clone我的整个项目再替换你自己的内容即可。
  2. 修改`config.js`配置后需要重新启动项目才会生效。
  3. 更多关于项目上手的问题，请查阅 [问答](/pages/9cc27d/)。
:::


## 版本升级

主题的版本会不定期更新，你只需更新npm主题包即可：
```sh
npm update vuepress-theme-vdoing
```

::: tip
1. 如更新后没起作用或报错，尝试把`node_modules`文件夹删除再`npm i`重新安装。
2. 在.vuepress/config.js中，设置`theme: 'vdoing'`才是使用npm主题依赖包:
```js
// config.js
module.exports = {
  theme: 'vdoing', // npm主题依赖包
  // theme: require.resolve('../../vdoing'), // 使用本地主题包
}
```
:::
-->